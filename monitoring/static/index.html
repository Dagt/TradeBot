<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>TradeBot Monitoring</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    section { margin-bottom: 1.5rem; }
    pre { background: #f4f4f4; padding: 10px; }
  </style>
</head>
<body>
<div id="app">
  <h1>TradeBot Monitoring</h1>

  <section>
    <h2>Metrics</h2>
    <div v-if="!metrics">Loading...</div>
    <pre v-else>{{ metrics }}</pre>
  </section>

  <section>
    <h2>PnL</h2>
    <div v-if="!pnl">Loading...</div>
    <div v-else>Current: {{ pnl.pnl.toFixed(2) }}</div>
  </section>

  <section>
    <h2>Risk</h2>
    <div v-if="!risk">Loading...</div>
    <div v-else>
      Events: {{ risk.events }}<br>
      Exposure: {{ JSON.stringify(risk.exposure) }}
    </div>
  </section>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return { metrics: null, pnl: null, risk: null };
  },
  methods: {
    async fetchData() {
      this.metrics = await fetch('/metrics/summary').then(r => r.json());
      const pnl = await fetch('/pnl/summary').then(r => r.json());
      const exposure = await fetch('/risk/exposure').then(r => r.json());
      const events = await fetch('/risk/events').then(r => r.json());
      this.pnl = pnl;
      this.risk = { exposure: exposure.exposure, events: events.events };
    },
    connectWS() {
      const proto = location.protocol === 'https:' ? 'wss' : 'ws';
      const ws = new WebSocket(proto + '://' + location.host + '/ws');
      ws.onmessage = e => {
        const data = JSON.parse(e.data);
        if (data.metrics) this.metrics = data.metrics;
        if (data.pnl) this.pnl = data.pnl;
        if (data.risk) this.risk = data.risk;
      };
      ws.onclose = () => setTimeout(this.connectWS, 1000);
    }
  },
  mounted() {
    this.fetchData();
    this.connectWS();
  }
}).mount('#app');
</script>
</body>
</html>
